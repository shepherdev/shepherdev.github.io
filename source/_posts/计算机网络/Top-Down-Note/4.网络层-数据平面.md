---
title: 4.网络层-数据平面
date: 2020-06-01 21:00
author: shepherd
toc: true
mathJax: true
categories: [计算机网络,Top-Down-Note]
tags: []
---

 网络层分两部分讲解，数据平面和控制平面(区分这两个概念很重要)，该章主要讲解了数据报输入输出链路的选择、IP转发、通用转发、IPv4和IPv6.

> 理清楚术语有利于学习本章: 数据包和分组是同一概念, 都是packet翻译过来的. 数据报和数据包有点类似, 比如UDP数据报, IP数据报, TCP数据包, UDP数据包, IP数据包..

<!-- more -->

## 4.1-Overview

路由器的数据平面将数据报从输入链路转发到输出链路，网络控制平面主要控制着数据报进行端到端传输。

### 4.1.1-转发和路由：数据和控制平面

将数据发送至目标主机，有两个重要的网络层功能。

- **转发**：对于数据的输入选择合适的输出链路（几纳秒），对应数据平面
- **路由**：网络层必须确定数据包采用的路由或路径（几秒），相关算法称为路由算法，对应控制平面

路由器的关键是**转发表**，路由器会检查每个数据包首部字段，查询转发表以确定输出链路。

*控制平面的传统方法*

每个路由器都有一个可以和其他路由器通信的路由组件，路由器之间通过通信计算转发表的值

*控制平面的SDN方法*

 software-defined networking (SDN)将控制平面提升到了远程控制，通过远程控制器来分配转发表的值。

### 4.1.2-网络服务模型

网络服务模型定义了发送方与接收方之间数据包的传递特性.

网络层能提供的**部分服务:**

- **保证交付数据**: 确保源数据包可以到达目的主机. 此外还可以指定时延范围进行传递
- **有序的数据包**: 保证数据包按照发送顺序到达目的主机. 
- ***保证最小带宽**: 在指定的链路速率下, 只要发送速率低于链路速率, 那么所有数据包都会到达目的主机.  
- **安全性**: 在源主机进行加密, 目的主机进行解密即可保证安全性.

但是Internet网络层提供的是**尽力而为服务**, 不保证到达-延迟-带宽, 虽然有其他模型满足上述服务, 但事实证明了尽力而为服务和现下非常契合. 

> 注意: 有两种类型交换机, 针对网络层的叫数据包交换机, 转发策略根据数据包头的信息决定, 通俗来说把数据包交换机叫路由器; 针对链路层的交换机是链路层设备. 

## 4.2-路由器剖析

路由器架构如图

![router-architecture](/home/shepherdev/blog_image/article/2020/router-architecture.png)

- **输入端口**

  这个端口不是TCP套接字的端口, 而是代表物理端口(或者说接口更合适), 图中三个方框分别代表物理层, 链路层, 网络层. 
  
  功能: 1. 物理链路与物理层的交互. 2. 链路层的交互. 3. 网络层, 查询转发表将数据包通过**交换结构**转发到输出接口. 
  
- **交换结构**

  将输入端口连接到输出端口, 它完全包含在路由器中, 是一个网络路由器中的网络. 

- **输出端口**

  存储从交换结构得到的数据包, 通过执行链路层和物理层的功能后在传输链路上进行传输. 如果链路是双向传输, 则输入和输出端口在印刷电路上有特殊的结构

- **路由处理器**

  执行的是控制平面的功能. 

  在传统的路由器中, 执行**路由器协议**, 维护路由表和链路状态信息, 并计算转发表.

  在SDN的路由器中, 它负责和远程控制器通信, 为路由器计算转发表

  ### 4.2.1-处理输入端口和基于目标的转发

  